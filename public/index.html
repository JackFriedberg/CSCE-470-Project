<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>NBA Team Creation</title>
  </head>
  
  <body>
    <h1>NBA Team Creation</h1> 
    <div class="container"> 
      <div class="container"> 
        <h3>Team</h3> <!-- Editable title for the team -->
        <div class="grid-container" id = "teamContainer">
          <div><a href="#center" id="player1">  </a></div>
          <div><a href="#pointguard" id = "player2">  </a></div>
          <div><a href="#smallforward" id="player3">  </a></div>
          <div><a href="#powerforward" id="player4"> </a></div>
          <div><a href="#shootingguard" id="player5">  </a></div>
        </div>
      </div>

      <div class="container">
        <!-- This is where team results will show up once the team is full-->
      </div>

      <!--TEsting for search-->
      <h3>Search Solr Below:</h3>
        <div>
          Search Text: <input type="text" name="searchText" id="searchText">
          <input type="button" value="Submit" onclick="sendSearch()">
        </div>
        <div>
          <div id = "resultsDiv">
            <h3>Results</h3> 
          </div>
        </div>
    </div>
   
    <script src="/socket.io/socket.io.js"></script> <!-- Script for Socket IO API (FIXME when hosting somewhere new)--> 
    <script>
      //socket io variable - talks front end to backend 
      var socket = io();

      var player1;

      var player2;

      var player3;
      
      var player4;

      var player5;

      var team1 = {player1, player2, player3, player4, player5};

      //get the value inside the input box and send it to the backend
      function sendSearch(){
        var searchText = document.getElementById('searchText').value;
        var searchString = '*' + searchText + '*~.3';
        socket.emit('search', searchString);
      }

      //this function runs when backend passes Solr queries to the front end
      socket.on('sendResults', function(results){
        //output search results in the console
        console.log(results.response);
        //get the documents returned
        allDocs = results.response.docs;
        //get the div to be updated with results
        var divToUpdate = document.getElementById("resultsDiv");
        //delete all prior results
        while (divToUpdate.firstChild) {
          divToUpdate.removeChild(divToUpdate.firstChild);
        }
        //for each document, make a new <P> element and store the entry id inside. Then append to the results div
        for (i = 0; i < allDocs.length; i++){
          var responseString = allDocs[i].name + ' (' + allDocs[i].season + ')';
          var responseEntry = document.createElement("div");
          responseEntry.innerHTML = responseString;
          var addButton = document.createElement("input");
          addButton.setAttribute('type', 'button');
          addButton.setAttribute('value', 'add');
          addButton.setAttribute('onclick', 'savePlayer(this)');
          addButton.setAttribute('data-stats', JSON.stringify(allDocs[i]));
          responseEntry.appendChild(addButton);
          divToUpdate.appendChild(responseEntry);
        }
      });


      function savePlayer(element){
        playerStats = element.getAttribute('data-stats');
        var objectStats = JSON.parse(playerStats);
        
        if(player1 == undefined){
          player1 = objectStats;
          if(document.getElementById("errorMessage")){
            document.getElementById("errorMessage").remove();
          }
          refreshTeam();
          return;
        }
        if(player2 == undefined){
          player2 = objectStats;
          if(document.getElementById("errorMessage")){
            document.getElementById("errorMessage").remove();
          }
          refreshTeam();
          return;
        }
        if(player3 == undefined){
          player3 = objectStats;
          if(document.getElementById("errorMessage")){
            document.getElementById("errorMessage").remove();
          }
          refreshTeam();
          return;
        }
        if(player4 == undefined){
          player4 = objectStats;
          if(document.getElementById("errorMessage")){
            document.getElementById("errorMessage").remove();
          }
          refreshTeam();
          return;
        }
        if(player5 == undefined){
          player5 = objectStats;
          if(document.getElementById("errorMessage")){
            document.getElementById("errorMessage").remove();
          }
          refreshTeam();
          return;
        }

        if(!document.getElementById("errorMessage")){
          var teamDiv = document.getElementById("teamContainer");
          var errorMessage = document.createElement("p");
          errorMessage.innerHTML = "Team is full!";
          errorMessage.setAttribute('id', "errorMessage");
          teamDiv.appendChild(errorMessage);
        }
      }

      function deletePlayer(element){
        var objectID = element.getAttribute('id');
        var playerToDelete;

        if(objectID == "player1Button"){
          player1 = undefined;
          playerToDelete = document.getElementById("player1");
        }
        if(objectID == "player2Button"){
          player2 = undefined;
          playerToDelete = document.getElementById("player2");
        }
        if(objectID == "player3Button"){
          player3 = undefined;
          playerToDelete = document.getElementById("player3");
        }
        if(objectID == "player4Button"){
          player4 = undefined;
          playerToDelete = document.getElementById("player4");
        }
        if(objectID == "player5Button"){
          player5 = undefined;
          playerToDelete = document.getElementById("player5");
        }

        while (playerToDelete.firstChild) {
          playerToDelete.removeChild(playerToDelete.firstChild);
        }

        if(document.getElementById("errorMessage")){
            document.getElementById("errorMessage").remove();
          }

        refreshTeam();

      }

      function refreshTeam(){
        var player1Container = document.getElementById("player1");
        var player2Container = document.getElementById("player2");
        var player3Container = document.getElementById("player3");
        var player4Container = document.getElementById("player4");
        var player5Container = document.getElementById("player5");

        if(player1 != undefined){
          player1Container.innerHTML = "Player 1: " + player1.name;
          player1Container.setAttribute('data-stats', JSON.stringify(player1));
          var addButton = document.createElement("input");
          addButton.setAttribute('type', 'button');
          addButton.setAttribute('value', 'delete');
          addButton.setAttribute('onclick', 'deletePlayer(this)');
          addButton.setAttribute('id', 'player1Button');
          player1Container.appendChild(addButton);
        }
        if(player2 != undefined){
          player2Container.innerHTML = "Player 2: " + player2.name;
          player2Container.setAttribute('data-stats', JSON.stringify(player2));
          var addButton = document.createElement("input");
          addButton.setAttribute('type', 'button');
          addButton.setAttribute('value', 'delete');
          addButton.setAttribute('onclick', 'deletePlayer(this)');
          addButton.setAttribute('id', 'player2Button');
          player2Container.appendChild(addButton);
        }
        if(player3 != undefined){
          player3Container.innerHTML = "Player 3: " + player3.name;
          player3Container.setAttribute('data-stats', JSON.stringify(player3));
          var addButton = document.createElement("input");
          addButton.setAttribute('type', 'button');
          addButton.setAttribute('value', 'delete');
          addButton.setAttribute('onclick', 'deletePlayer(this)');
          addButton.setAttribute('id', 'player3Button');
          player3Container.appendChild(addButton);
        }
        if(player4 != undefined){
          player4Container.innerHTML = "Player 4: " + player4.name;
          player4Container.setAttribute('data-stats', JSON.stringify(player4));
          var addButton = document.createElement("input");
          addButton.setAttribute('type', 'button');
          addButton.setAttribute('value', 'delete');
          addButton.setAttribute('onclick', 'deletePlayer(this)');
          addButton.setAttribute('id', 'player4Button');
          player4Container.appendChild(addButton);
        }
        if(player5 != undefined){
          player5Container.innerHTML = "Player 5: " + player5.name;
          player5Container.setAttribute('data-stats', JSON.stringify(player5));
          var addButton = document.createElement("input");
          addButton.setAttribute('type', 'button');
          addButton.setAttribute('value', 'delete');
          addButton.setAttribute('onclick', 'deletePlayer(this)');
          addButton.setAttribute('id', 'player5Button');
          player5Container.appendChild(addButton);
        }
      }

    </script>
  </body>
</html>
